-- ---
-- Table 'project'
--
-- ---

DROP TABLE IF EXISTS `project`;

CREATE TABLE `project` (
  `id` INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
  `slug` TEXT NOT NULL,
  `name` TEXT NOT NULL,
  `desc` TEXT NULL DEFAULT NULL,
  `icon` TEXT NULL DEFAULT NULL,
  `sort` DOUBLE NOT NULL DEFAULT 0,
  `chunks_url` TEXT NULL DEFAULT NULL,
  `source_language_id` INTEGER NOT NULL,
  UNIQUE (`source_language_id`, `slug`),
  FOREIGN KEY (source_language_id) REFERENCES `source_language` (`id`)
);

-- ---
-- Table 'project__category'
--
-- ---

DROP TABLE IF EXISTS `project__category`;

CREATE TABLE `project__category` (
  `id` INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
  `project_id` INTEGER NOT NULL DEFAULT NUL,
  `category_id` INTEGER NOT NULL,
  `name` TEXT NOT NULL,
  FOREIGN KEY (project_id) REFERENCES `project` (`id`),
  FOREIGN KEY (category_id) REFERENCES `category` (`id`)
);

-- ---
-- Table 'questionnaire'
--
-- ---

DROP TABLE IF EXISTS `questionnaire`;

CREATE TABLE `questionnaire` (
  `id` INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
  `language_slug` TEXT NOT NULL,
  `language_name` TEXT NOT NULL,
  `language_direction` TEXT NOT NULL DEFAULT ltr
);

-- ---
-- Table 'category'
--
-- ---

DROP TABLE IF EXISTS `category`;

CREATE TABLE `category` (
  `id` INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
  `slug` TEXT NOT NULL,
  `parent_id` INTEGER NOT NULL
);

-- ---
-- Table 'chunk_marker'
--
-- ---

DROP TABLE IF EXISTS `chunk_marker`;

CREATE TABLE `chunk_marker` (
  `id` INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
  `chapter` TEXT NOT NULL,
  `verse` TEXT NOT NULL,
  `versification_id` INTEGER NOT NULL,
  UNIQUE (`versification_id`, `chapter`, `verse`),
  FOREIGN KEY (versification_id) REFERENCES `versification` (`id`)
);

-- ---
-- Table 'source_language'
--
-- ---

DROP TABLE IF EXISTS `source_language`;

CREATE TABLE `source_language` (
  `id` INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
  `slug` TEXT NOT NULL,
  `name` TEXT NOT NULL,
  `direction` TEXT NOT NULL DEFAULT ltr,
  UNIQUE (`slug`)
);

-- ---
-- Table 'resource'
--
-- ---

DROP TABLE IF EXISTS `resource`;

CREATE TABLE `resource` (
  `id` INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
  `slug` TEXT NOT NULL,
  `name` TEXT NOT NULL,
  `translate_mode` TEXT NOT NULL,
  `checking_level` TEXT NOT NULL,
  `comments` TEXT NULL DEFAULT NULL,
  `pub_date` DATE NULL DEFAULT NULL,
  `license` TEXT NOT NULL,
  `version` TEXT NOT NULL,
  `project_id` INTEGER NOT NULL,
  UNIQUE (`project_id`, `slug`),
  FOREIGN KEY (project_id) REFERENCES `project` (`id`)
);

-- ---
-- Table 'questionnaire_question'
--
-- ---

DROP TABLE IF EXISTS `questionnaire_question`;

CREATE TABLE `questionnaire_question` (
  `id` INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
  `text` TEXT NOT NULL,
  `help` TEXT NOT NULL,
  `is_required` INTEGER NOT NULL DEFAULT 0,
  `input_type` TEXT NOT NULL,
  `sort` INTEGER NOT NULL DEFAULT 0,
  `depends_on` INTEGER NULL DEFAULT NULL,
  `question_td_id` INTEGER NOT NULL,
  `questionnaire_id` INTEGER NOT NULL,
  FOREIGN KEY (questionnaire_id) REFERENCES `questionnaire` (`id`)
);

-- ---
-- Table 'questionnaire_data_field'
--
-- ---

DROP TABLE IF EXISTS `questionnaire_data_field`;

CREATE TABLE `questionnaire_data_field` (
  `id` INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
  `field` TEXT NOT NULL,
  `question_td_id` INTEGER NOT NULL,
  `questionnaire_id` INTEGER NOT NULL,
  FOREIGN KEY (questionnaire_id) REFERENCES `questionnaire` (`id`)
);

-- ---
-- Table 'target_language'
--
-- ---

DROP TABLE IF EXISTS `target_language`;

CREATE TABLE `target_language` (
  `id` INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
  `slug` TEXT NOT NULL,
  `name` TEXT NOT NULL,
  `direction` TEXT NOT NULL DEFAULT ltr,
  `region` TEXT NOT NULL
);

-- ---
-- Table 'temp_target_language'
--
-- ---

DROP TABLE IF EXISTS `temp_target_language`;

CREATE TABLE `temp_target_language` (
  `id` INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
  `slug` TEXT NOT NULL,
  `name` TEXT NOT NULL,
  `direction` TEXT NOT NULL DEFAULT ltr,
  `region` TEXT NOT NULL,
  `approved_target_language_slug` TEXT NULL DEFAULT NULL
);

-- ---
-- Table 'versification'
--
-- ---

DROP TABLE IF EXISTS `versification`;

CREATE TABLE `versification` (
  `id` INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
  `slug` TEXT NOT NULL,
  `name` TEXT NOT NULL,
  `project_id` INTEGER NOT NULL,
  FOREIGN KEY (project_id) REFERENCES `project` (`id`)
);

-- ---
-- Table 'catalog'
--
-- ---

DROP TABLE IF EXISTS `catalog`;

CREATE TABLE `catalog` (
  `id` INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
  `slug` TEXT NOT NULL,
  `url` TEXT NOT NULL,
  `modified_at` INTEGER NOT NULL
);

-- ---
-- Indexes
-- ---

CREATE INDEX `project_slug` ON `project`(`slug`);
CREATE INDEX `project__category_category_id` ON `project__category`(`category_id`);

CREATE INDEX `category_slug` ON `category`(`slug`);
CREATE INDEX `category_parent_id` ON `category`(`parent_id`);

CREATE INDEX `questionnaire_slug` ON `questionnaire`(`slug`);
CREATE INDEX `questionnaire_question_depends_on` ON `questionnaire_question`(`depends_on`);
CREATE INDEX `questionnaire_data_field_field` ON `questionnaire_data_field`(`field`);

CREATE INDEX `source_language_slug` ON `source_language`(`slug`);

CREATE INDEX `resource_slug` ON `resource`(`slug`);
CREATE INDEX `resource_translate_mode` ON `resource`(`translate_mode`);
CREATE INDEX `resource_checking_level` ON `resource`(`checking_level`);

CREATE INDEX `target_language_slug` ON `target_language`(`slug`);
CREATE INDEX `target_language_name` ON `target_language`(`name`);

CREATE INDEX `temp_target_language_slug` ON `temp_target_language`(`slug`);
CREATE INDEX `temp_target_language_name` ON `temp_target_language`(`name`);
CREATE INDEX `temp_target_language_approved_target_language_slug` ON `temp_target_language`(`approved_target_language_slug`);

CREATE INDEX `versification_slug` ON `versification`(`slug`);

CREATE INDEX `catalog_slug` ON `catalog`(`slug`);